<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login - SIMPEG PPPK</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        th,
        td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .success {
            color: #10b981;
            font-weight: bold;
        }

        .error {
            color: #ef4444;
            font-weight: bold;
        }

        .pending {
            color: #f59e0b;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .summary {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .stat {
            padding: 15px 25px;
            border-radius: 8px;
            text-align: center;
        }

        .stat.total {
            background: #e0e7ff;
            color: #4338ca;
        }

        .stat.ok {
            background: #d1fae5;
            color: #059669;
        }

        .stat.fail {
            background: #fee2e2;
            color: #dc2626;
        }

        .stat h2 {
            margin: 0;
            font-size: 28px;
        }

        .stat p {
            margin: 5px 0 0;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>üîç Verifikasi Login Semua User</h1>
        <p>Test ini akan mengecek apakah semua 27 user yang sudah ditambahkan bisa login dengan benar.</p>

        <div class="summary" id="summary" style="display:none;">
            <div class="stat total">
                <h2 id="totalCount">0</h2>
                <p>Total User</p>
            </div>
            <div class="stat ok">
                <h2 id="okCount">0</h2>
                <p>Login Berhasil</p>
            </div>
            <div class="stat fail">
                <h2 id="failCount">0</h2>
                <p>Login Gagal</p>
            </div>
        </div>

        <button class="btn" id="testBtn" onclick="testAllLogins()">üß™ Test Semua Login</button>

        <table>
            <thead>
                <tr>
                    <th>No</th>
                    <th>Username (NIP)</th>
                    <th>Password</th>
                    <th>Nama</th>
                    <th>Status Login</th>
                </tr>
            </thead>
            <tbody id="userTable">
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://nkkszblyffksojkizomh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ra3N6Ymx5ZmZrc29qa2l6b21oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyOTgwMDUsImV4cCI6MjA4Mjg3NDAwNX0.qfHVnczBIIvRELkykBWHFlpVpvm6e7EhXDDzp4zMRu0';

        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Daftar semua user yang harus bisa login
        const allUsers = [
            { username: '199804162025211000', password: '1998', name: 'Adi Tya Kusuma' },
            { username: '197502102025211030', password: '1975', name: 'Agus Suhaeri' },
            { username: '199709242025211061', password: '1997', name: 'Akbar Solihin Zulkifli' },
            { username: '199905182025211036', password: '1999', name: 'Asep Saepul Anwar' },
            { username: '199703202025211056', password: '1997', name: 'Chaeril Hari Mugeni' },
            { username: '199911262025211039', password: '1999', name: 'Deni Bachtiar' },
            { username: '199609212025211070', password: '1996', name: 'Doni Safutra' },
            { username: '199808232025211048', password: '1998', name: 'Erdinda Sukmadinata' },
            { username: '199705212025211051', password: '1997', name: 'Fajar Triadi' },
            { username: '199403092025211074', password: '1994', name: 'Fauzi Ramadan' },
            { username: '198807052025211119', password: '1988', name: 'Juliyana Mulyadani' },
            { username: '200001012025211065', password: '2000', name: 'Nahdi Ramhan' },
            { username: '199401112025211066', password: '1994', name: 'Nandar Sukmana' },
            { username: '199511032025211069', password: '1995', name: 'Novaldi Setiawan' },
            { username: '199811162025212048', password: '1998', name: 'Raden Yunita' },
            { username: '199801012025211072', password: '1998', name: 'Rizky Ramandani' },
            { username: '200001102025211041', password: '2000', name: 'Sendy Dwi Pangga' },
            { username: '199510252025211082', password: '1995', name: 'Seno Albianto' },
            { username: '199406192025212073', password: '1994', name: 'Sri Handayani' },
            { username: '199412302025211074', password: '1994', name: 'Sugianto' },
            { username: '199610222025211050', password: '1996', name: 'Teguh Nurhakim' },
            { username: '199902042025211036', password: '1999', name: 'Vareski Nalfaredo' },
            { username: '199701052025212061', password: '1997', name: 'Vivi Hastuti' },
            { username: '199706182025211052', password: '1997', name: 'Zico Arya Pratama' },
            { username: '197812202025211041', password: '1978', name: 'Wellem Aufa' },
            { username: '198008092025211055', password: '1980', name: 'David Indra' },
            { username: '199303242025211140', password: '1993', name: 'Rm.Rangga Putra' }
        ];

        const userStatus = {};
        let okCount = 0, failCount = 0;

        function renderTable() {
            const tbody = document.getElementById('userTable');
            tbody.innerHTML = allUsers.map((user, idx) => {
                const status = userStatus[user.username];
                let statusClass = 'pending';
                let statusText = '‚è≥ Menunggu';

                if (status === true) {
                    statusClass = 'success';
                    statusText = '‚úÖ Login OK';
                } else if (status === false) {
                    statusClass = 'error';
                    statusText = '‚ùå Gagal';
                }

                return `
                    <tr>
                        <td>${idx + 1}</td>
                        <td><code>${user.username}</code></td>
                        <td>${user.password}</td>
                        <td>${user.name}</td>
                        <td class="${statusClass}">${statusText}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateSummary() {
            document.getElementById('summary').style.display = 'flex';
            document.getElementById('totalCount').textContent = allUsers.length;
            document.getElementById('okCount').textContent = okCount;
            document.getElementById('failCount').textContent = failCount;
        }

        async function testAllLogins() {
            const btn = document.getElementById('testBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Mengecek...';

            okCount = 0;
            failCount = 0;

            for (const user of allUsers) {
                try {
                    const { data, error } = await supabaseClient
                        .from('users')
                        .select('*')
                        .eq('username', user.username)
                        .eq('password', user.password)
                        .maybeSingle();

                    if (error) {
                        userStatus[user.username] = false;
                        failCount++;
                    } else if (data) {
                        userStatus[user.username] = true;
                        okCount++;
                    } else {
                        userStatus[user.username] = false;
                        failCount++;
                    }
                } catch (err) {
                    userStatus[user.username] = false;
                    failCount++;
                }
                renderTable();
                updateSummary();
            }

            btn.textContent = '‚úÖ Test Selesai!';

            if (failCount === 0) {
                alert('üéâ Semua ' + allUsers.length + ' user berhasil diverifikasi! Semua bisa login.');
            } else {
                alert('‚ö†Ô∏è Ada ' + failCount + ' user yang gagal. Cek tabel untuk detailnya.');
            }
        }

        renderTable();
    </script>
</body>

</html>